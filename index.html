<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="google" content="notranslate" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="title" content="Green Runchly">
	<meta name="author" content="Green Runchly">
	<link rel="icon" href="assets/me.png">

	<title>Green Runchly</title>

	<meta property="og:site_name" content="Green Runchly">
    <meta property="og:title" content="Green Runchly" />
    <meta property="og:description" content="Rizki's Personal Website" />
    <meta property="og:image" itemprop="image" content="assets/me.png">
    <meta property="og:type" content="website" />

	<!-- Bootstrap Style -->
    <link href="assets/css/bootstrap-5.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="assets/css/bootstrap-5.3.2-dist/js/bootstrap.bundle.min.js"></script>
	
	<!-- JQuery -->
	<script src="assets/js/jquery-3.5.1.min.js"></script>
    <script src="assets/js/jquery.countdown.js"></script>
</head>
<style>
	body{
		margin: 0px;
		padding: 0px;
		background: #00b081;
		background-attachment: fixed;
	}
	.main{
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100vh;
	}
	.logo{
		display: flex;
		align-items: center;
		justify-content: center;
		width: 300px;
		height: 300px;
		border-radius: 50%;
		transition: 0.3s;
		border:1rem solid white;
		transform: scale(1);
		-webkit-tap-highlight-color: transparent;
		cursor: pointer;
	}
	.logo.bass-overlay{
		position: absolute;
		opacity: 0.2;
	}
	.logo img{
		width: 100%;
		height: 100%;
		object-fit: cover;
		border-radius: 50%;
		overflow: hidden;
		cursor: pointer;
	}
	.logo.paused{
		z-index: 99;
	}
	.logo.paused:active{
		transform: scale(1.1);
		filter: drop-shadow(10px 10px 4px #4444dd4c);
		transition: 0.02s;
		border:0.4rem solid white;
	}
	.logo.paused:active img{
		transition: 0.05s;
	}

	.mediaplayer{
		opacity: 1;
		transition: 0.5s;
	}
	.mediaplayer.hide{
		opacity: 0;
	}
	.mediaplayer.hide:hover{
		opacity: 1;
	}
	.spectrume{
		position: absolute;
		display: flex;
		align-items: flex-end;
		list-style-type: none;
		margin: 0rem;
		padding: 0rem;
		/* z-index: 9999; */
	}
	.spectrume li{
		position: absolute;
		width: 9px;
		min-height: 140px;
		background-color: white;
		transform-origin: 0% 100% 0;
		border-radius: 3px;
	}
</style>
<body class="overflow-hidden">	
	<div class="main overflow-hidden" id="flash">
		<ul class="spectrume" id="spectrumeBeat"></ul>
		<a class="logo paused mediaPlayerStarter" id="spectrumeBass">
			<img src="assets/me.png" draggable="false">
		</a>
		<a class="logo bass-overlay" id="spectrumeBassOverlay">
			<img src="assets/me.png" draggable="false">
		</a>
	</div>
	<div class="container-fluid py-2 px-2 fixed-bottom">
		<div class="row">
			<div id="mediaPlayer" class="col d-none d-lg-block mediaplayer hide">
				<div class="row g-2" id="mediaPlayerControl">
					<div class="col-auto col-lg-auto">
						<button class="btn btn-success mediaPlayerStarter" id="mediaPlayerStarter">Play</button>
					</div>
					<div class="col col-lg-auto">
						<audio class="d-none" id="mediaPlayerAudio" controls loop>
							<source src="assets/audio/bumbblebee.webm" type="audio/mpeg">
						</audio>
						<input class="form-control d-none" id="mediaPlayerSelector" type="file" accept="audio/*" />
						<label for="mediaPlayerSelector" class="btn btn-success">Ubah Lagu</label>
					</div>
					<div class="col-auto col-lg-auto">
						<button class="btn btn-success" id="mediaPlayerToggle">Tampil Panel</button>
					</div>
				</div>
			</div>
			<div class="col-12 col-lg-auto d-flex  justify-content-center justify-content-lg-end align-items-end">
				<div class="btn text-white">
					<p class="m-0">&copy2024 GreenRunchly</p>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="assets/js/p5.js"></script>
<script src="assets/js/p5.sound.js"></script>
<script>
	$(document).on("click", "#mediaPlayerToggle", function(e) {
		isit = $("#mediaPlayer").hasClass('hide');
        if (isit == true){
            $("#mediaPlayer").removeClass('hide');
			$("#mediaPlayerToggle").html('Tutup Panel');
        }else{
            $("#mediaPlayer").addClass('hide');
			$("#mediaPlayerToggle").html('Tampil Panel');
        }
    });
	$(document).on("change", "#mediaPlayerSelector", function(e) {
        var files = this.files;
        $("#mediaPlayerAudio").attr("src", URL.createObjectURL(files[0]));
        $("#mediaPlayerAudio")[0].play();
    });
    $(document).on("click", ".mediaPlayerStarter", function(e) {
        if ($('#mediaPlayerAudio').prop("paused") == true){
            $("#mediaPlayerAudio")[0].play();
			$("#mediaPlayerStarter").html('Pause');
			$("#spectrumeBass").removeClass('paused');
        }else{
            $("#mediaPlayerAudio")[0].pause();
			$("#mediaPlayerStarter").html('Play');
			$("#spectrumeBass").addClass('paused');
        }
    });
</script>
<script type="text/javascript">
    let canvas;
    let fft;

	let teethRatio = 16; let teethRange = 1024; // Mengikuti length dari waveform atau spectrum

    function setup() {
        canvas = createCanvas(10, 10);
        canvas.position(0, 0);
        canvas.style('pointer-events', 'none');

        fft = new p5.FFT();
        let context = getAudioContext();
        for (let elem of selectAll('audio')) {
            let mediaSource = context.createMediaElementSource(elem.elt);
            mediaSource.connect(p5.soundOut);
        }
		peakDetect = new p5.PeakDetect();
	
		// Init DOM untuk spectrume
		for (let index = 0; index < (teethRange/teethRatio); index++) {
			let rot = ((360)/(teethRange/teethRatio))*index;
			$(".spectrume").append(`<li class="teeth-${index}" style="transform:rotate(${rot}deg);"></li>`);
		}
		
    }

    function touchStarted() {
        getAudioContext().resume();
    }
	let bass_buffer = 0; let flash_buffer = 0;
    function draw() {
        let spectrum = fft.analyze();
        let waveform = fft.waveform();

		// Spectrume Bars
		let beat_base = spectrum; let beat_temp = 0; let beat_length = beat_base.length;
		for (let i = 0; i < ( ((teethRange/teethRatio))); i++) {
			beat_teeth = beat_base[i] * 2;
			beat_temp += beat_base[i];

			let teethPos = (Math.round(i));
			let teethHeight = 80 + (beat_teeth / 4)
			$("#spectrumeBeat li").eq((teethPos)).css("height",`${teethHeight}px`);
			$("#spectrumeBeat li").eq(teethPos).css("opacity",`${(0.3+(beat_teeth/beat_length))}`);
		}
		
		let beat = (beat_temp / (beat_length)) / (teethRange/teethRatio);
		// console.log(beat);

		// Bass Logo
		let bass_base = waveform; let bass_temp = 0; let bass_length = bass_base.length;
		for (let i = 0; i < (bass_length); i++) {
            bass_temp += bass_base[i];
        }
		if (bass_temp > bass_buffer){
			bass_buffer = bass_temp;
		}else{
			bass_buffer -= bass_buffer/3;
		}
		let bass = (bass_buffer/bass_length) * 1.5;

		// Flash
		let flash_temp = 0;
		peakDetect.update(fft);
		if ( peakDetect.isDetected ) {
			flash_temp = beat;
		}
		if (flash_temp > flash_buffer){
			flash_buffer = flash_temp;
		}else{
			flash_buffer -= flash_buffer/60;
		}
		let flash = flash_buffer*2;

		// DOM Manipulation
		$("#flash").css("background", `linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,${flash}) 100%)`);
		// $("#flash").css("background", `rgba(255, 255, 255, ${flash})`);
		$("#spectrumeBass").css("transform", `scale(${(1-bass)})`);
		$("#spectrumeBassOverlay").css("transform", `scale(${(1+bass)})`);
    }
</script>
</html>
