<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="google" content="notranslate" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="title" content="Green Runchly">
	<meta name="author" content="Green Runchly">
	<link rel="icon" href="assets/me.png">

	<title>Green Runchly</title>

	<meta property="og:site_name" content="Green Runchly">
    <meta property="og:title" content="Green Runchly" />
    <meta property="og:description" content="Rizki's Personal Website" />
    <meta property="og:image" itemprop="image" content="assets/me.png">
    <meta property="og:type" content="website" />

	<!-- Bootstrap Style -->
    <link href="assets/css/bootstrap-5.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="assets/css/bootstrap-5.3.2-dist/js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="assets/css/bootstrap-icons-1.11.3/font/bootstrap-icons.min.css">
	
	<!-- JQuery -->
	<script src="assets/js/jquery-3.5.1.min.js"></script>
    <script src="assets/js/jquery.countdown.js"></script>

	<!-- DB Framework -->
	<script src="assets/js/localforage/dist/localforage.js"></script>

	<!-- JSMedia -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
</head>
<style>
	body{
		margin: 0px;
		padding: 0px;
		background: #00b081;
		background-attachment: fixed;
	}
	.main{
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100vh;
	}
	.logo{
		display: flex;
		align-items: center;
		justify-content: center;
		width: 300px;
		height: 300px;
		border-radius: 50%;
		border:1rem solid white;
		transform: scale(1);
		-webkit-tap-highlight-color: transparent;
		cursor: pointer;
		z-index: 989;
	}
	.logo.bass-overlay{
		position: absolute;
		opacity: 0.2;
		z-index: 990;
	}
	.logo img{
		width: 100%;
		height: 100%;
		object-fit: cover;
		border-radius: 50%;
		overflow: hidden;
		cursor: pointer;
	}
	.visibilitas{
		opacity: 1;
		transition: 0.5s;
	}
	.visibilitas.hide{
		opacity: 0;
	}
	.visibilitas.hide:hover{
		opacity: 1;
	}
	.music-progress-bar{
		height: 7px;
	}
	.music-progress-bar .filler{
		width: calc(var(--progress));
		min-width: 16px;
		transition: 0.5s;
	}
	.spectrume{
		position: absolute;
		display: flex;
		align-items: flex-end;
		list-style-type: none;
		margin: 0rem;
		padding: 0rem;
		/* z-index: 9999; */
	}
	.spectrume li{
		position: absolute;
		width: 5px;
		background-color: white;
		border-radius: 10px;
	}

	.video{
		background-color: black;
	}
	.video video{
		--vid-opacity: 50%;
		width: 100%;
		height: 100%;
		object-fit: cover;
		filter: blur(3px) opacity(var(--vid-opacity));
	}
	video::-webkit-media-controls {
		display: none !important;
	}
	video::-webkit-media-controls-enclosure {
		display: none !important;
	}
	video::-webkit-media-controls-panel {
		display: none !important;
	}
	video::-webkit-media-controls-play-button {
		display: none !important;
	}

	.bgm{
		background-color: black;
	}
	.bgm img{
		--vid-opacity: 50%;
		width: 100%;
		height: 100%;
		object-fit: cover;
		filter: blur(3px) opacity(var(--vid-opacity));
	}

	@media screen and (max-width: 600px), screen and (max-height: 600px) {
		.dynamic-div {
			transform: scale(80%);
		}
	}

	@media screen and (max-width: 400px), screen and (max-height: 400px) {
		.dynamic-div {
			transform: scale(75%);
		}
	}

</style>
<body class="overflow-hidden">	
	<div class="d-block position-relative overflow-hidden" id="flash">
		<div class="main dynamic-div">
			<ul style="transform: rotate(45deg);" class="spectrume" id="spectrumeBeat">
			</ul>
			<a class="logo" id="spectrumeBass">
				<img src="assets/me.png" draggable="false">
			</a>
			<a class="logo paused mediaPlayerStarter bass-overlay" id="spectrumeBassOverlay">
				<img src="assets/me.png" draggable="false">
			</a>
		</div>
	</div>
	<div class="container-fluid py-2 px-2 fixed-top">
		<div class="row">
			<div class="col-12 visibilitas mediaList">
				<div class="row g-1 lh-sm">
					<div class="col-12">
						<div class="row g-1">
							<div class="col-auto d-block">
								<button class="btn btn-success mediaListLibraryToggle"><i class="bi bi-music-note-list"></i></button>
							</div>
							<div class="col-auto">
								<label class="btn btn-success importMusic" for="mediaPlayerMusicImporter"><i class="bi bi-plus-circle-fill"></i></label>
							</div>
							<div class="col-auto d-none confirmRemoveAllMusicToggle">
								<button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmRemoveAllMusic"><i class="bi bi-radioactive"></i></button>
							</div>
							<div class="col">
								<a class="btn btn-success text-white text-end reloadMusic">
									<p class="m-0" id="mediaPlayerMusicImporterStatus">Muat Perpustakaan Musik</p>
								</a>
							</div>
						</div>
					</div>
				</div>
				<div class="row g-1 my-1">
					<div class="col-12 col-sm-6 col-md-5 col-lg-4 col-xl-3 overflow-hidden overflow-y-scroll rounded-3 lh-sm mediaListLibrary" style="max-height: 40vh;">
						<div class="row g-1">
							<div class="col-12">
								<a class="btn btn-success text-white text-start w-100">
									<small class="m-0">Klik muat perpustakaan untuk memuat lagu yang tersimpan sebelumnya.</small>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid py-2 px-2 fixed-bottom visibilitas" id="mediaPlayer">
		<div class="row g-2 py-2" id="mediaPlayerControl">
			<div class="col-auto">
				<button class="btn btn-success mediaPlayerStarter" id="mediaPlayerStarter"><i class="bi bi-play-fill"></i></button>
				<audio class="d-none" id="mediaPlayerAudio" controls>
					<source src="assets/audio/the drum.webm" type="audio/mpeg">
				</audio>
				<input class="form-control d-none" type="file" id="mediaPlayerMusicImporter" accept="audio/*" webkitdirectory directory multiple />
			</div>
			<div class="col-auto d-block">
				<button class="btn btn-success mediaPlayerToggle"><i class="bi bi-eye-fill"></i></button>
			</div>
			<div class="col-auto d-block">
				<button class="btn btn-success fullscreen"><i class="bi bi-fullscreen"></i></button>
			</div>
			<div class="col-auto d-none d-sm-flex flex-column justify-content-center">
				<div class="btn text-white text-start p-0 m-0 lh-1">
					<p class="m-0 p-0"><small id="mediaPlayerAudioTitle">Alan Walker - The Drum</small></p>
					<small class="m-0 p-0"><small class="m-0 p-0"><small id="mediaPlayerAudioProgressTextCurrent">0.00</small>%</small></small>
				</div>
			</div>
			<div class="col d-flex justify-content-end justify-content-lg-end align-items-end">
				<a class="btn text-white text-end" href="https://greenrunchly.my.id">
					<p class="m-0">&copy2024 GreenRunchly</p>
				</a>
			</div>
		</div>
		<div class="row">
			<div class="col-12">
				<div class="music-progress-bar bg-body w-100 rounded-3">
					<div class="filler bg-success h-100 rounded-3" id="mediaPlayerAudioProgress" style="--progress:100%;"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="confirmRemoveAllMusic" tabindex="-1" aria-hidden="true" data-bs-backdrop="false">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header text-danger">
					<h1 class="modal-title fs-5">Hapus Data Perpustakaan?</h1>
				</div>
				<div class="modal-body">
					<p class="m-0">Seluruh data perpustakaan musik akan dihapus keseluruhan, yakin?</p>
				</div>
				<div class="modal-footer row g-1">
					<div class="col">
						<button type="button" class="btn btn-secondary w-100" data-bs-dismiss="modal">Tidak Jadi</button>
					</div>
					<div class="col">
						<button type="button" class="btn btn-danger w-100 removeAllMusic" data-bs-dismiss="modal">Kosongkan</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
<script src="assets/js/p5.js"></script>
<script src="assets/js/p5.sound.js"></script>
<script>
	// Fungsi untuk meminta elemen masuk ke mode layar penuh
	function requestFullscreen(element) {
		if (element.requestFullscreen) {
			element.requestFullscreen();
		} else if (element.mozRequestFullScreen) { // Untuk Firefox
			element.mozRequestFullScreen();
		} else if (element.webkitRequestFullscreen) { // Untuk Chrome, Safari, dan Opera
			element.webkitRequestFullscreen();
		} else if (element.msRequestFullscreen) { // Untuk IE/Edge
			element.msRequestFullscreen();
		}
	}
	// Fungsi untuk keluar dari mode layar penuh
	function exitFullscreen(element) {
		if (element.exitFullscreen) {
			element.exitFullscreen();
		} else if (element.mozCancelFullScreen) { // Untuk Firefox
			element.mozCancelFullScreen();
		} else if (element.webkitExitFullscreen) { // Untuk Chrome, Safari, dan Opera
			element.webkitExitFullscreen();
		} else if (element.msExitFullscreen) { // Untuk IE/Edge
			element.msExitFullscreen();
		}
	}
	// Fullscreen
	$(document).on("click", ".fullscreen", function(e) {
		var element = document.documentElement; // Document root element
		console.log(document.fullscreenElement);
		if (document.fullscreenElement !== null){
			exitFullscreen(document);
		}else{
			requestFullscreen(element);
		}
    	
	});
</script>
<script>
	// Setel Koneksi Database
	let importedSongs = localforage.createInstance({
        name: "LaguTest"
    });
	let importedSongsMeta = localforage.createInstance({
        name: "LaguTestMeta"
    });

	// Preload Music Listing
	function loadMusicListing() {
		$(".mediaList").children('div').eq(1).children('div').children('div').empty();
		// Membaca Database
		importedSongsMeta.iterate(function(musicMeta, key, iterationNumber) {
			let title = musicMeta.fullTitle;
			$(".mediaList").children('div').eq(1).children('div').children('div').prepend(`
				<div class="col-12">
					<div class="row g-1">
						<div class="col-auto">
							<button class="btn btn-danger removeMusic" music-number="${key}"><i class="bi bi-trash-fill"></i></button>
						</div>
						<div class="col">
							<a class="btn btn-success text-start w-100 selectMusic" music-number="${key}">
								<small class="m-0">${title}</small>
							</a>
						</div>
					</div>
				</div>
			`); 
			if (iterationNumber > 0){
				$(".confirmRemoveAllMusicToggle").removeClass('d-none');
			}
			// Status Alerting
			$("#mediaPlayerMusicImporterStatus").html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Memuat Data... ${title}`);
		}).then(function() {
			$("#mediaPlayerMusicImporterStatus").html('Perpustakaan Musik');
		}).catch(function(err) {
			$("#mediaPlayerMusicImporterStatus").html('<i class="bi bi-exclamation-triangle-fill"></i> Gagal Membuka Data!');
			console.error("Error during iteration", err);
		});
	} 

	// Music Importer
    $('#mediaPlayerMusicImporter').on('change', function(event) {
        const files = event.target.files; 

		// Alert Init
		$("#mediaPlayerMusicImporterStatus").html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Menyiapkan...`);
	
		// Function untuk konversi file ke base64
		function file2Base64(file) {
			return new Promise((resolve, reject) => {
				const reader = new FileReader();
				reader.readAsDataURL(file);
				reader.onload = () => resolve(reader.result);
				reader.onerror = error => reject(error);
			});
		}

		// Cek audio atau bukan
		function isAudioFile(file) {
			// Check MIME type
			const audioMimeTypes = [
				'audio/mpeg', // mp3
				'audio/wav',  // wav
				'audio/ogg',  // ogg
				'audio/mp4',  // mp4
				'audio/x-aiff', // aiff
				'audio/x-wav',  // wav
				'audio/webm', // webm
				'audio/flac', // flac
			];

			if (audioMimeTypes.includes(file.type)) {
				return true;
			}

			// Check file extension as a fallback
			const audioExtensions = ['mp3', 'wav', 'ogg', 'mp4', 'aiff', 'wav', 'webm', 'flac'];
			const fileExtension = file.name.split('.').pop().toLowerCase();

			if (audioExtensions.includes(fileExtension)) {
				return true;
			}

			return false;
		}

		// Function menambahkan musik ke library
		function tambahMusik(file, fileUniqueID, fileMetadata, fullTitle) {
			return new Promise((resolve, reject) => {
				// Menyimpan Metadata Ke Database
				importedSongsMeta.setItem(fileUniqueID, fileMetadata).then(async function () {
					// Alert Sistem
					$("#mediaPlayerMusicImporterStatus").html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Scanning... (${fullTitle})`);
					
					// Konversi File ke Base64
					let tempFileBuffer = await file2Base64(file);

					// Menyimpan File Ke Database
					importedSongs.setItem(fileUniqueID, tempFileBuffer).then(function () {
						resolve(); console.log('Tersimpan!');
					}).catch(function (err) {
						reject(); console.log(err);
					});
				}).catch(function (err) {
					reject(); console.log(err);
				});
			});
		}

		// Proses Menyimpan (Delay 2 Detik)
		let diupload = 0; let diantrian = 0; let diimpor = 0; 
		setTimeout(() => {
			// Iteration file (melakukan scan)
			$.each(files, async function(index, file) {
				if (((file.size > (1 * 1024 * 1024))) && (isAudioFile(file))){ 
					// Detail File
					let fileName = file.name;
					let fileExt = file.name.split('.').pop().toLowerCase();
					let fileSize = file.size;
					let fileUniqueID = fileSize.toString();

					let title, artist; title = fileName; artist = fileUniqueID;
					let fullTitle = `${artist} - ${title}`;

					// Membaca Metadata File
					await jsmediatags.read(file, {
						onSuccess: async function(tag) {
							(tag.tags.title) ? title = tag.tags.title : title  = fileName; (tag.tags.artist) ? artist = tag.tags.artist : artist = fileUniqueID;
							let fullTitle = `${artist} - ${title}`;
							let fileMetadata = {title:title, artist:artist, fullTitle:fullTitle};
							
							// Menambahkan Musik
							try {
								await setTimeout( async () => {
									let result = await tambahMusik(file, fileUniqueID, fileMetadata, fullTitle);
									diimpor ++;
								}, 1000);
							} catch (error) {
								// Gagal Menambahkan
								console.error(error);
								diimpor ++;
							}
						},
						onError: async function(error) {
							let fileMetadata = {title:title, artist:artist, fullTitle:fullTitle};
							
							// Menambahkan Musik
							try {
								await setTimeout( async () => {
									let result = await tambahMusik(file, fileUniqueID, fileMetadata, fullTitle);
									diimpor ++;
								}, 1000);
							} catch (error) {
								// Gagal Menambahkan
								console.error(error);
								diimpor ++;
							}
						}
					});
					diantrian ++;
				}
				diupload ++;
			});

			let waitingScanner = setInterval(() => {
				console.log('Scanning...', diupload, diantrian, diimpor);
				if (diantrian == diimpor) {
					// Alert Import End
					$("#mediaPlayerMusicImporterStatus").html(`<i class="bi bi-check-circle"></i> Impor Selesai!`);
					// loadMusicListing();
					clearInterval(waitingScanner);
					console.log('Scan Done!', diimpor);
				}
			}, 100);
		}, 2000);
    });

	// Reload Listing Music
	$(document).on("click", ".reloadMusic", function(e) {
		loadMusicListing();
	});

	// Play Selected Music
	$(document).on("click", ".selectMusic", function(e) {
		let musicID = $(this).attr('music-number');
		
		importedSongsMeta.getItem(musicID).then(function (musicMeta) {
			let title = `${musicID}`;
			if (musicMeta.title){
				title = `${musicMeta.artist} - ${musicMeta.title}`;
			}
			$("#mediaPlayerAudioTitle").html(title);
			$(`.selectMusic`).removeClass('btn-light');
			$(`.selectMusic[music-number=${musicID}]`).addClass('btn-light');
			importedSongs.getItem(musicID).then(function (music) {
				$("#mediaPlayerAudio").attr("current-media", musicID);
				$("#mediaPlayerAudio").attr("src", music);
				$("#mediaPlayerAudio")[0].play();
			}).catch(function (err) {
				console.log(err);
			});
		}).catch(function (err) {
			console.log(err);
		});
	});

	// Hapus Music
	$(document).on("click", ".removeMusic", function(e) {
		let musicID = $(this).attr('music-number');
		let musicDOM = $(this);
		console.log('removing', musicID);
		$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
		importedSongs.removeItem(musicID).then(function() {
			importedSongsMeta.removeItem(musicID).then(function() {
				musicDOM.parent().parent().parent().remove();
			}).catch(function(err) {
				alert("Gagal Menghapus Meta!");
			});
		}).catch(function(err) {
			alert("Gagal Menghapus!");
		});
	});

	// Hapus Semua Music
	$(document).on("click", ".removeAllMusic", function(e) {
		let me = this;
		importedSongs.clear().then(function() {
			importedSongsMeta.clear().then(function() {
				$(".confirmRemoveAllMusicToggle").addClass('d-none');
				loadMusicListing();
			}).catch(function(err) {
				alert("Gagal Menghapus Library Meta!");
			});
		}).catch(function(err) {
			alert("Gagal Menghapus Library!");
		});
	});

</script>
<script>
	$(document).on("click", ".mediaPlayerToggle", function(e) {
		isit = $(".visibilitas").hasClass('hide');
        if (isit == true){
            $(".visibilitas").removeClass('hide');
        }else{
            $(".visibilitas").addClass('hide');
        }
    });
	$(document).on("click", ".mediaListLibraryToggle", function(e) {
		isit = $(".mediaListLibrary").hasClass('d-none');
        if (isit == true){
            $(".mediaListLibrary").removeClass('d-none');
        }else{
            $(".mediaListLibrary").addClass('d-none');
        }
    });
	
    $(document).on("click", ".mediaPlayerStarter", function(e) {
		$('#mediaPlayerAudio').prop("paused") ? $("#mediaPlayerAudio")[0].play() : $("#mediaPlayerAudio")[0].pause();
		
		// Pause Button DOM
		if ($('#mediaPlayerAudio').prop("paused") == true){
			$("#mediaPlayerStarter").html('<i class="bi bi-play-fill"></i>');
			$("#spectrumeBass").removeClass('paused');
        }else{
			$("#mediaPlayerStarter").html('<i class="bi bi-pause-fill"></i>');
			$("#spectrumeBass").addClass('paused');
        }
	});
</script>
<script type="text/javascript">
    let canvas; let fft; let audioElement
	let teethRatio = 8; let teethMax = 1024; let teetUsed = (teethMax / teethRatio);  // Terdapat 64 teeth

    function setup() {
        canvas = createCanvas(10, 10);
        canvas.position(0, 0);
        canvas.style('pointer-events', 'none');

        fft = new p5.FFT(0.78);
        let context = getAudioContext();
        for (let elem of selectAll('audio')) {
            let mediaSource = context.createMediaElementSource(elem.elt);
            mediaSource.connect(p5.soundOut);
        }
		peakDetect = new p5.PeakDetect();
		audioElement = document.getElementById('mediaPlayerAudio');
		// Init DOM untuk spectrume sebanyak teeth yang dipakai
		for (let index = 0; index < teetUsed; index++) {
			let rot = ((360)/teetUsed)*index;
			$(".spectrume").append(`<li class="teeth-${index}" style="transform:rotate(${rot}deg) translateY(-140px); transform-origin: 0% 100%;"></li>`);
		}
		
    }

    function touchStarted() {
        getAudioContext().resume();
    }

	let count_delay = 0;
    function draw() {
        let spectrum = fft.analyze();
        let waveform = fft.waveform();

		// Audio Progress Bar, biar lengkap
		let musicCurrentTime = audioElement.currentTime;
		let musicDuration = audioElement.duration;
		let musicProgress = (musicCurrentTime/musicDuration) * 100;
		$("#mediaPlayerAudioProgress").css('--progress', `${musicProgress}%`);
		$("#mediaPlayerAudioProgressTextCurrent").html(`${musicProgress.toFixed(2)}`);

		// Spectrume Bars
		let beat_base = spectrum; let beat_temp = 0; let beat_length = beat_base.length;
		let beat_repeat = Math.round(teetUsed / 5); // teetUsed/{bebas}

		// Teeth
		let teethSelected = 0;
		for (let i = 0; i < (teetUsed); i++) { teethSelected ++;
			if (teethSelected % beat_repeat == 0) { teethSelected = teethSelected - beat_repeat; }
			beat_teeth = beat_base[ teethRatio * (teethSelected) ];
			
			let teethPos = i;
			let teethHeight = (( (beat_teeth/300) * (beat_teeth/300) * (beat_teeth/300) ) * beat_teeth * 1.5);
			let teethOpaque = 0.1 + (( (beat_teeth/255) * (beat_teeth/255) * (beat_teeth/200) ) * 0.4);
			$("#spectrumeBeat li").eq((teethPos)).css("height",`${teethHeight}px`);
			$("#spectrumeBeat li").eq(teethPos).css("opacity",`${(teethOpaque)}`);
		}

		// Bass dari beberapa Frekuensi
		bassEnergy = fft.getEnergy("bass");
		lowMidEnergy = fft.getEnergy("lowMid");
		midEnergy = fft.getEnergy("mid");
		highMidEnergy = fft.getEnergy("highMid");
		trebleEnergy = fft.getEnergy("treble");
		bass_e = (bassEnergy/512) * 0.8;
		gitar_e = (lowMidEnergy/512) * 0.5;
		snare_e = (midEnergy/512) * 0.3;
		simbal_e = (highMidEnergy/512) * 0.05;
		treble_e = (trebleEnergy/512) * 0.05;

		// DOM Manipulate spectrum bar secara langsung
		let combine = (bass_e + gitar_e + treble_e + snare_e + simbal_e) * 100;
		let bassStrength = ( (combine / 500) * (combine / 400) * (combine / 300) * (combine / 200) * (combine / 100) ) * combine;
		let bassAmplifier = bassStrength*6;
		$("#spectrumeBass").css("transform", `scale(${(1-(bassStrength))})`);
		$("#spectrumeBassOverlay").css("transform", `scale(${(1-bassStrength/2)})`);
		$("#flash").css("background", `radial-gradient(circle, rgba(255,255,255,${(bassAmplifier)}) 0%, rgba(255,255,255,0) 100%)`);
		
		// $(".video-wallpaper").css("background", `radial-gradient(circle, rgba(255,255,255,${(bassAmplifier)}) 0%, rgba(255,255,255,0) 100%)`);
		// $(".bgm-wallpaper").css("background", `radial-gradient(circle, rgba(255,255,255,${(bassAmplifier)}) 0%, rgba(255,255,255,0) 100%)`);
		// $(".bgm-wallpaper").css("transform", `scale(${(1+(bassStrength/8))})`);

		// Debugging
		if (count_delay > 60){
			// Do something :v
			count_delay = 0;
		}else{
			count_delay ++;
		}
    }
</script>
</html>
